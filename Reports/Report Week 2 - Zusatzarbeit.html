<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1 plus MathML 2.0//EN" "http://www.w3.org/Math/DTD/mathml2/xhtml-math11-f.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><!--This file was converted to xhtml by OpenOffice.org - see http://xml.openoffice.org/odf2xhtml for more info.--><head profile="http://dublincore.org/documents/dcmi-terms/"><meta http-equiv="Content-Type" content="application/xhtml+xml; charset=utf-8"/><title xml:lang="en-US">- no title specified</title><meta name="DCTERMS.title" content="" xml:lang="en-US"/><meta name="DCTERMS.language" content="en-US" scheme="DCTERMS.RFC4646"/><meta name="DCTERMS.source" content="http://xml.openoffice.org/odf2xhtml"/><meta name="DCTERMS.creator" content="Anton"/><meta name="DCTERMS.issued" content="2009-05-21T19:43:00" scheme="DCTERMS.W3CDTF"/><meta name="DCTERMS.contributor" content="hetz"/><meta name="DCTERMS.modified" content="2009-06-12T07:19:00" scheme="DCTERMS.W3CDTF"/><meta name="DCTERMS.provenance" content="" xml:lang="en-US"/><meta name="DCTERMS.subject" content="," xml:lang="en-US"/><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/" hreflang="en"/><link rel="
schema.DCTERMS" href="http://purl.org/dc/terms/" hreflang="en"/><link rel="schema.DCTYPE" href="http://purl.org/dc/dcmitype/" hreflang="en"/><link rel="schema.DCAM" href="http://purl.org/dc/dcam/" hreflang="en"/><style type="text/css">
	@page {  }
	table { border-collapse:collapse; border-spacing:0; empty-cells:show }
	td, th { vertical-align:top; font-size:12pt;}
	h1, h2, h3, h4, h5, h6 { clear:both }
	ol, ul { margin:0; padding:0;}
	li { list-style: none; margin:0; padding:0;}
	<!-- "li span.odfLiEnd" - IE 7 issue-->
	li span. { clear: both; line-height:0; width:0; height:0; margin:0; padding:0; }
	span.footnodeNumber { padding-right:1em; }
	span.annotation_style_by_filter { font-size:95%; font-family:Arial; background-color:#fff000;  margin:0; border:0; padding:0;  }
	* { margin:0;}
	.P1 { font-size:12pt; margin:100%; margin-bottom:0in; margin-left:0.5in; margin-right:0in; margin-top:0in; text-indent:0in; font-family:Arial; writing-mode:lr-tb; line-height:150%; text-align:justify ! important; }
	.P10 { font-size:10pt; margin-bottom:0in; margin-top:0in; font-family:Calibri; writing-mode:lr-tb; }
	.P11_borderStart { font-size:12pt; margin-top:0in; font-family:Arial; writing-mode:lr-tb; text-align:right ! important; padding-left:0in; padding-right:0in; padding-top:0in; border-left-style:none; border-right-style:none; border-top-style:none; padding-bottom:0in;  border-bottom-style:none; }
	.P11 { font-size:12pt; font-family:Arial; writing-mode:lr-tb; text-align:right ! important; padding-left:0in; padding-right:0in; border-left-style:none; border-right-style:none; padding-bottom:0in; padding-top:0in;  border-top-style:none; border-bottom-style:none; }
	.P11_borderEnd { font-size:12pt; margin-bottom:0in; font-family:Arial; writing-mode:lr-tb; text-align:right ! important; padding-left:0in; padding-right:0in; padding-bottom:0.0138in; border-left-style:none; border-right-style:none; border-bottom-width:0.018cm; border-bottom-style:solid; border-bottom-color:#000000; padding-top:0in;  border-top-style:none;}
	.P12_borderStart { font-size:12pt; margin-top:0in; font-family:Arial; writing-mode:lr-tb; text-align:center ! important; padding-left:0in; padding-right:0in; padding-top:0in; border-left-style:none; border-right-style:none; border-top-style:none; letter-spacing:0.0693in; font-weight:bold; padding-bottom:0in;  border-bottom-style:none; }
	.P12 { font-size:12pt; font-family:Arial; writing-mode:lr-tb; text-align:center ! important; padding-left:0in; padding-right:0in; border-left-style:none; border-right-style:none; letter-spacing:0.0693in; font-weight:bold; padding-bottom:0in; padding-top:0in;  border-top-style:none; border-bottom-style:none; }
	.P12_borderEnd { font-size:12pt; margin-bottom:0in; font-family:Arial; writing-mode:lr-tb; text-align:center ! important; padding-left:0in; padding-right:0in; padding-bottom:0.0138in; border-left-style:none; border-right-style:none; border-bottom-width:0.018cm; border-bottom-style:solid; border-bottom-color:#000000; letter-spacing:0.0693in; font-weight:bold; padding-top:0in;  border-top-style:none;}
	.P13_borderStart { font-size:9pt; margin-top:0in; font-family:Arial; writing-mode:lr-tb; text-align:right ! important; padding-left:0in; padding-right:0in; padding-top:0in; border-left-style:none; border-right-style:none; border-top-style:none; padding-bottom:0in;  border-bottom-style:none; }
	.P13 { font-size:9pt; font-family:Arial; writing-mode:lr-tb; text-align:right ! important; padding-left:0in; padding-right:0in; border-left-style:none; border-right-style:none; padding-bottom:0in; padding-top:0in;  border-top-style:none; border-bottom-style:none; }
	.P13_borderEnd { font-size:9pt; margin-bottom:0in; font-family:Arial; writing-mode:lr-tb; text-align:right ! important; padding-left:0in; padding-right:0in; padding-bottom:0.0138in; border-left-style:none; border-right-style:none; border-bottom-width:0.018cm; border-bottom-style:solid; border-bottom-color:#000000; padding-top:0in;  border-top-style:none;}
	.P2 { font-size:12pt; margin-bottom:0.139in; margin-top:0in; font-family:Arial; writing-mode:lr-tb; text-align:justify ! important; }
	.P3 { font-size:12pt; margin-bottom:0.139in; margin-top:0in; font-family:Arial; writing-mode:lr-tb; text-align:justify ! important; }
	.P4 { font-size:12pt; margin-bottom:0.139in; margin-top:0in; font-family:Arial; writing-mode:lr-tb; }
	.P5 { font-size:12pt; margin-bottom:0.139in; margin-top:0in; font-family:Arial; writing-mode:lr-tb; text-align:justify ! important; }
	.P6 { font-size:12pt; margin-bottom:0.139in; margin-top:0in; font-family:Arial; writing-mode:lr-tb; text-align:justify ! important; letter-spacing:0.0417in; }
	.P7 { font-size:12pt; margin-bottom:0.139in; margin-top:0in; font-family:Cambria; writing-mode:lr-tb; text-align:justify ! important; }
	.P8 { font-size:12pt; margin-bottom:0in; margin-top:0in; font-family:Arial; writing-mode:lr-tb; line-height:150%; text-align:justify ! important; letter-spacing:0.0417in; }
	.P9 { font-size:10pt; margin-bottom:0in; margin-top:0in; font-family:Calibri; writing-mode:lr-tb; }
	.T1 { font-size:9pt; }
	.T2 { letter-spacing:0.0693in; font-weight:bold; }
	.T3 { letter-spacing:0.0417in; }
	<!-- ODF styles with no properties representable as CSS -->
	.T4 .T5 .T6 { }
	</style></head><body dir="ltr" style="max-width:8.2681in;margin-top:0.9839in; margin-bottom:0.7874in; margin-left:0.9839in; margin-right:0.9839in; writing-mode:lr-tb; "><p class="P13_borderStart">Roth Anton, Quignon Christoph</p><p class="P11"><span class="T1">Sommersemester 2009</span><span class="T2"> </span></p><p class="P12_borderEnd">Project Report – Week 2</p><p class="P8"> </p><p class="P6">Topic:</p><p class="P2">For the purpose to get 6 ECTS points we are attending an additional project. This project includes, following a black line along a closed way, recognizing a full turn and remembering the way and driving it without the black line again. Our second task in this project was to recognize one complete round on the given closed way.</p><p class="P4"> </p><p class="P6">General Idea:</p><p class="P2">The theoretical procedure to perceive when the Robot has finished one complete round is to sum up every rotation and compare the outcome with a precalculated 360 degree turn. In the first meeting which 
introduced some possible paths, all paths were successive straight lines, without any arcs or curves. Therefore, in theory, the sum of all angles were 0/360 degree. In practice, the line isn't a 2 dimensional line, but a tape, and the robot isn't parallel to this line at all. This means, that whenever the robot misses the line, he will rotate and sum up very little angles. In addition, the robot can not predict if the next line segment lies to the right or to the left. The search pattern will produce additional angles, which don't belong to the given path. The last problem, was that the tolerance may include the correction on a line, including the first line, and detect the complete round toe early, or too late.</p><p class="P7"> </p><p class="P6">First Approach: time based</p><p class="P2">So far, there were no calculation of angles implemented or derivable from the NXT API. Nonetheless the driving speed was constant, which implied an analogy between the passing time at one search period and the angle to 
the next straight line. The orientation of the angle were also given by the code, from which the absolute angle, which of course differs when driven to right and to the left, could be calculated. To keep the rounding errors small, we swapped from adding all angles up, to adding angles found to the right and subtracting angles found to the left. The outcome then should be zero degree. </p><p class="P2">The underlying data structure were three arrays. The first indicating the direction to the angle, the second indicating the passing time to reach the angle, and the third indicating the passing time driven forward to the next angle. We abandon the possibility of creating an own data structure, for it would only raise the complexety level.</p><p class="P7"> </p><p class="P6">Second approach: engine turn based</p><p class="P2">Due to unsatisfying results, we changed the angle computation principle. Another factor indicating the angles driven were the motor rotation count. The motor rotation count register “the 
program-relative position counter value of the specified output”, where the output is a motor. The motor rotation count is set to zero when the NXT starts up. It increases if the motor rotates forward and decreases if the motor rotates backwards. The comparison between the two used motors therefore indicates the current orientation. The motor rotation count can therefore tell when the current orientation is the orientation when the program started. This is, on the previous given specification of the way to follow a simple way to tell, when a complete round was driven.</p><p class="P7"> </p><p class="P5"><span class="T3">Problems</span><span class="T5">:</span></p><p class="P3"><span class="T4">Several problems occurred in this weeks task. One of the early problems were the data storage structure, old NXC versions can't handle multidimensional arrays, and the initiation of own data structures is quite complicated. But the most simple way, separate arrays worked fine. A more systematical error occurred in the 
computation of the absolute angle of turn. To minimize backwards drifting the search procedure doesn't hold when no line was found and the search direction changes. The counting of consecutive changes in the search direction enabled us to compute the absolute angle.</span></p><p class="P2">To further improve the precision of the detection of a complete turn, it was necessary to implement a variable indicating, if the NXT already had crossed an big angle in distinction to a correction on a straight line. Without this, a correction of a straight line could be too little to cross the tolerance owed to measurement and rounding errors. Another possibility to avoid this could be, to set the robot in front of a big turn, when starting the program. The second approach so far has an unsolved systematical error. The motor rotation count is just indicating, if the orientation, not the absolute position. This difference can be observed, if two or more line in the track are parallel, the robot will announce a complete 
turn, whenever he reaches a line parallel to starting orientation. This problem was mentioned at the first introduction of the project and is accepted to this state. Late it can be fixed by checking the absolute driven distance on an arbitrary coordinate system. </p><p class="P7"> </p><p class="P7"> </p><p class="P7"> </p><p class="P7"> </p><p class="P7"> </p><p class="P7"> </p><p class="P7"> </p><p class="P7"> </p><p class="P7"> </p><p class="P7"> </p><p class="P7"> </p><p class="P8">Attachement:</p><ol><li><p class="P1" style="margin-left:1.27cm;"><span style="display:block;float:left;min-width:0cm">1.</span>NXC – Code<span class="odfLiEnd"/> </p></li></ol><p class="P9">int lightIntens = 40; //Schwellwert fÃ¼r Lichtsensor</p><p class="P9">int speed = 60; //Fahrspeed</p><p class="P9">int time = 40;</p><p class="P9">bool firstTurn;</p><p class="P9"> </p><p class="P9">task drive()</p><p class="P9">{</p><p class="P10"><span class="T6">      </span><span class="T4">OnFwdSync(OUT_AB, speed, 0);</span></p><p 
class="P9">}</p><p class="P9"> </p><p class="P9">task search()</p><p class="P9">{</p><p class="P10"><span class="T6">     </span><span class="T4">time = 40;</span></p><p class="P10"><span class="T6">     </span><span class="T4">while(true){</span></p><p class="P10"><span class="T6">        </span><span class="T4">OnFwdSync(OUT_AB, speed, 100); //left</span></p><p class="P10"><span class="T6">        </span><span class="T4">Wait(time);</span></p><p class="P10"><span class="T6">        </span><span class="T4">time=time + 300;</span></p><p class="P10"><span class="T6">        </span><span class="T4">OnFwdSync(OUT_AB, speed, -100);   //right</span></p><p class="P10"><span class="T6">        </span><span class="T4">Wait(time);</span></p><p class="P10"><span class="T6">        </span><span class="T4">time=time + 300;</span></p><p class="P10"><span class="T6">        </span><span class="T4">}</span></p><p class="P9">}</p><p class="P9"> </p><p class="P9">sub fullCircle(){</p><p class="P9">if(firstTurn){</p><p class="
P9"><span> if((MotorRotationCount(OUT_A)-20)&lt;=MotorRotationCount(OUT_B) &amp;&amp; MotorRotationCount(OUT_B)&lt;=(MotorRotationCount(OUT_A)+20))</span></p><p class="P9"><span> {</span></p><p class="P9"><span> </span><span> SoundPlayToneType sptArgs;</span></p><p class="P9"><span> </span><span> sptArgs.Frequency = 440;</span></p><p class="P9"><span> </span><span> sptArgs.Duration = 400;</span></p><p class="P9"><span> </span><span> sptArgs.Loop = false;</span></p><p class="P9"><span> </span><span> sptArgs.SoundLevel = 3;</span></p><p class="P9"><span> </span><span> SysSoundPlayTone(sptArgs);</span></p><p class="P9"><span> </span><span> Wait(2000);</span></p><p class="P9"><span> }</span></p><p class="P9">}</p><p class="P9"> </p><p class="P9">}</p><p class="P9"> </p><p class="P9">sub aufliniepruefer()</p><p class="P9">{</p><p class="P10"><span class="T6">   </span><span class="T4">fullCircle();</span></p><p class="P10"><span class="T6">   </span><span class="T4">start drive;</span></p><p class="P10"><span 
class="T6">   </span><span class="T4">SetSensorLight(IN_1);</span></p><p class="P9"><span> while(true)</span></p><p class="P9"><span> {</span></p><p class="P9"><span> </span><span> if(Sensor(IN_1) &gt; lightIntens)</span></p><p class="P10"><span class="T6">    </span><span class="T4">{</span></p><p class="P10"><span class="T6">       </span><span class="T4">Off(OUT_AB);</span></p><p class="P10"><span class="T6">       </span><span class="T4">break;</span></p><p class="P10"><span class="T6">    </span><span class="T4">}</span></p><p class="P10"><span class="T6">  </span><span class="T4">}</span></p><p class="P9">}</p><p class="P9"> </p><p class="P9">sub wegvonliniepruefer()</p><p class="P9">{</p><p class="P9">SetSensorLight(IN_1);</p><p class="P9">firstTurn= true;</p><p class="P9"><span> while(true)</span></p><p class="P9"><span> {</span></p><p class="P9"><span> </span><span> if(Sensor(IN_1) &lt;= lightIntens)</span></p><p class="P10"><span class="T6">    </span><span class="T4">{</span></p><p class="P10"
><span class="T6">       </span><span class="T4">stop search;</span></p><p class="P10"><span class="T6">       </span><span class="T4">Off(OUT_AB);</span></p><p class="P10"><span class="T6">       </span><span class="T4">break;</span></p><p class="P10"><span class="T6">    </span><span class="T4">}</span></p><p class="P10"><span class="T6">  </span><span class="T4">}</span></p><p class="P9">}</p><p class="P9"> </p><p class="P9">task main()</p><p class="P9">{</p><p class="P9"><span> firstTurn = false;</span></p><p class="P9"><span> SetSensorLight(IN_1);</span></p><p class="P9"><span> while(true){</span></p><p class="P10"><span class="T6">    </span><span class="T4">        aufliniepruefer();</span></p><p class="P10"><span class="T6">    </span><span class="T4">        start search;</span></p><p class="P10"><span class="T6">    </span><span class="T4">        wegvonliniepruefer();</span></p><p class="P10"><span class="T6">    </span><span class="T4">        Wait(100);</span></p><p class="P10"><span class="T6"> 
   </span><span class="T4">}</span></p><p class="P9">}</p></body></html>
